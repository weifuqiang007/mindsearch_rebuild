# MindSearchAgent å›¾çŠ¶æ€ç®¡ç†åŠŸèƒ½æŒ‡å—

## æ¦‚è¿°

æœ¬é¡¹ç›®ä¸º MindSearchAgent æ·»åŠ äº†å›¾çŠ¶æ€ç®¡ç†åŠŸèƒ½ï¼Œä½¿å…¶èƒ½å¤Ÿæ›´æ™ºèƒ½åœ°å¤„ç†å¤æ‚æŸ¥è¯¢ã€‚å›¾çŠ¶æ€ç®¡ç†æä¾›äº†æŸ¥è¯¢æ‰§è¡Œçš„å¯è§†åŒ–ã€å¹¶è¡Œå¤„ç†ã€ä¾èµ–ç®¡ç†å’Œè¯¦ç»†ç»Ÿè®¡ç­‰åŠŸèƒ½ã€‚

## æ ¸å¿ƒç»„ä»¶

### 1. SimpleSearchGraph (core/simple_graph.py)

å›¾çŠ¶æ€ç®¡ç†çš„æ ¸å¿ƒç±»ï¼Œæä¾›ä»¥ä¸‹åŠŸèƒ½ï¼š

- **èŠ‚ç‚¹ç®¡ç†**: åˆ›å»ºå’Œç®¡ç†ä¸åŒç±»å‹çš„èŠ‚ç‚¹ï¼ˆROOTã€SEARCHã€RESULTã€ENDï¼‰
- **è¾¹ç®¡ç†**: å»ºç«‹èŠ‚ç‚¹ä¹‹é—´çš„ä¾èµ–å…³ç³»
- **çŠ¶æ€è·Ÿè¸ª**: è·Ÿè¸ªæ¯ä¸ªèŠ‚ç‚¹çš„æ‰§è¡ŒçŠ¶æ€ï¼ˆPENDINGã€RUNNINGã€COMPLETEDã€FAILEDï¼‰
- **æ‰§è¡Œè°ƒåº¦**: è·å–å¯ä»¥æ‰§è¡Œçš„èŠ‚ç‚¹ï¼ˆæ‰€æœ‰ä¾èµ–éƒ½å·²å®Œæˆï¼‰

```python
from core.simple_graph import SimpleSearchGraph, NodeType, NodeStatus

# åˆ›å»ºå›¾
graph = SimpleSearchGraph()

# æ·»åŠ èŠ‚ç‚¹
root_id = graph.add_node("root", "æ ¹èŠ‚ç‚¹", NodeType.ROOT)
search_id = graph.add_node("search", "æœç´¢èŠ‚ç‚¹", NodeType.SEARCH)

# æ·»åŠ è¾¹ï¼ˆä¾èµ–å…³ç³»ï¼‰
graph.add_edge(root_id, search_id)

# æ›´æ–°èŠ‚ç‚¹çŠ¶æ€
graph.update_node_status(root_id, NodeStatus.COMPLETED)

# è·å–å¯æ‰§è¡ŒèŠ‚ç‚¹
ready_nodes = graph.get_ready_nodes()
```

### 2. å¢å¼ºçš„ MindSearchAgent (agents/mindsearch_agent.py)

åŸæœ‰çš„ MindSearchAgent ç°åœ¨é›†æˆäº†å›¾çŠ¶æ€ç®¡ç†åŠŸèƒ½ï¼š

#### æ–°å¢æ–¹æ³•ï¼š

- `_create_search_graph(query_plan)`: æ ¹æ®æŸ¥è¯¢è®¡åˆ’åˆ›å»ºæœç´¢å›¾
- `_execute_graph_search(graph, callback)`: æ‰§è¡ŒåŸºäºå›¾çš„æœç´¢
- `_execute_graph_sub_query(graph, node_id, sub_query, callback)`: æ‰§è¡Œå•ä¸ªå›¾èŠ‚ç‚¹çš„å­æŸ¥è¯¢
- `get_graph_statistics()`: è·å–å›¾æ‰§è¡Œç»Ÿè®¡ä¿¡æ¯

#### å·¥ä½œæµç¨‹ï¼š

1. **æŸ¥è¯¢åˆ†æ**: åˆ†æç”¨æˆ·æŸ¥è¯¢å¹¶ç”ŸæˆæŸ¥è¯¢è®¡åˆ’
2. **å›¾åˆ›å»º**: æ ¹æ®æŸ¥è¯¢è®¡åˆ’åˆ›å»ºæœç´¢å›¾
3. **å›¾æ‰§è¡Œ**: æŒ‰ç…§ä¾èµ–å…³ç³»å¹¶è¡Œæ‰§è¡Œæœç´¢èŠ‚ç‚¹
4. **ç»“æœç”Ÿæˆ**: æ±‡æ€»æ‰€æœ‰æœç´¢ç»“æœå¹¶ç”Ÿæˆæœ€ç»ˆç­”æ¡ˆ

## ä½¿ç”¨ç¤ºä¾‹

### åŸºæœ¬ä½¿ç”¨

```python
import asyncio
from agents.mindsearch_agent import MindSearchAgent
from core.search_manager import SearchManager

async def example():
    # åˆ›å»ºæœç´¢ç®¡ç†å™¨
    search_manager = SearchManager()
    
    # åˆ›å»º MindSearchAgent
    agent = MindSearchAgent(
        search_manager=search_manager,
        max_sub_queries=5,
        max_search_results=10
    )
    
    # å®šä¹‰å›è°ƒå‡½æ•°ç›‘æ§è¿›åº¦
    def callback(message: str, **kwargs):
        print(f"è¿›åº¦: {message}")
    
    # æ‰§è¡Œæœç´¢
    result = await agent.asearch(
        query="äººå·¥æ™ºèƒ½çš„å‘å±•å†å²å’Œåº”ç”¨é¢†åŸŸ",
        callback=callback
    )
    
    print(f"æœç´¢ç»“æœ: {result}")
    
    # è·å–ç»Ÿè®¡ä¿¡æ¯
    stats = agent.get_session_statistics()
    print(f"å›¾ç»Ÿè®¡: {stats.get('graph_stats', {})}")

# è¿è¡Œç¤ºä¾‹
asyncio.run(example())
```

### é«˜çº§ä½¿ç”¨

æŸ¥çœ‹ `examples/graph_search_example.py` è·å–æ›´è¯¦ç»†çš„ä½¿ç”¨ç¤ºä¾‹ï¼ŒåŒ…æ‹¬ï¼š

- å¤æ‚æŸ¥è¯¢å¤„ç†
- å›¾å¯è§†åŒ–
- é”™è¯¯å¤„ç†
- æ€§èƒ½ç»Ÿè®¡

## å›¾åŠŸèƒ½ä¼˜åŠ¿

### 1. å¹¶è¡Œæ‰§è¡Œ

ç‹¬ç«‹çš„å­æŸ¥è¯¢å¯ä»¥å¹¶è¡Œæ‰§è¡Œï¼Œæé«˜æ•´ä½“æŸ¥è¯¢æ•ˆç‡ï¼š

```
åŸå§‹æŸ¥è¯¢: "AIçš„å†å²ã€åº”ç”¨å’Œæœªæ¥"

å›¾ç»“æ„:
root â†’ search_history (AIå†å²)
    â†’ search_applications (AIåº”ç”¨) 
    â†’ search_future (AIæœªæ¥)
    â†’ result â†’ end

æ‰§è¡Œé¡ºåº:
æ­¥éª¤1: æ‰§è¡Œ search_history
æ­¥éª¤2: å¹¶è¡Œæ‰§è¡Œ search_applications å’Œ search_future
æ­¥éª¤3: æ‰§è¡Œ result æ±‡æ€»
æ­¥éª¤4: æ‰§è¡Œ end ç»“æŸ
```

### 2. æ™ºèƒ½ä¾èµ–ç®¡ç†

è‡ªåŠ¨å¤„ç†å­æŸ¥è¯¢ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼š

```python
# å­æŸ¥è¯¢ä¾èµ–ç¤ºä¾‹
sub_queries = [
    SubQuery(id="q1", query="åŸºç¡€æ¦‚å¿µ", dependencies=[]),
    SubQuery(id="q2", query="é«˜çº§åº”ç”¨", dependencies=["q1"]),  # ä¾èµ– q1
    SubQuery(id="q3", query="å®é™…æ¡ˆä¾‹", dependencies=["q1", "q2"])  # ä¾èµ– q1 å’Œ q2
]

# å›¾ä¼šè‡ªåŠ¨æŒ‰ä¾èµ–é¡ºåºæ‰§è¡Œï¼šq1 â†’ q2 â†’ q3
```

### 3. é”™è¯¯å¤„ç†å’Œæ¢å¤

æ™ºèƒ½å¤„ç†èŠ‚ç‚¹å¤±è´¥å’Œä¾èµ–é”™è¯¯ï¼š

- å•ä¸ªèŠ‚ç‚¹å¤±è´¥ä¸ä¼šå½±å“å…¶ä»–ç‹¬ç«‹èŠ‚ç‚¹
- ä¾èµ–å¤±è´¥çš„èŠ‚ç‚¹ä¼šè¢«è‡ªåŠ¨æ ‡è®°ä¸ºå¤±è´¥
- æä¾›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯å’Œç»Ÿè®¡

### 4. è¯¦ç»†ç»Ÿè®¡ä¿¡æ¯

æä¾›ä¸°å¯Œçš„æ‰§è¡Œç»Ÿè®¡ä¿¡æ¯ï¼š

```python
stats = agent.get_session_statistics()
graph_stats = stats['graph_stats']

print(f"æ€»èŠ‚ç‚¹æ•°: {graph_stats['total_nodes']}")
print(f"æˆåŠŸç‡: {graph_stats['success_rate']:.2%}")
print(f"æ‰§è¡Œæ—¶é—´: {graph_stats['execution_time']:.2f}ç§’")
```

## æµ‹è¯•

### è¿è¡Œå›¾åŠŸèƒ½æµ‹è¯•

```bash
# æµ‹è¯•å›¾ç»“æ„å’Œæ‰§è¡Œé€»è¾‘ï¼ˆä¸ä¾èµ–æœç´¢å¼•æ“ï¼‰
python test/test_graph_only.py

# æµ‹è¯•å®Œæ•´çš„å›¾æœç´¢åŠŸèƒ½
python test/test_graph_search.py

# è¿è¡Œä½¿ç”¨ç¤ºä¾‹
python examples/graph_search_example.py
```

### æµ‹è¯•è¾“å‡ºç¤ºä¾‹

```
=== æµ‹è¯•å›¾åˆ›å»ºå’Œæ‰§è¡Œæµç¨‹ ===

ğŸ“Š å›¾ç»Ÿè®¡:
  èŠ‚ç‚¹æ•°: 6
  è¾¹æ•°: 7

ğŸ”„ æ¨¡æ‹Ÿæ‰§è¡Œæµç¨‹:
  æ­¥éª¤ 1: æ‰§è¡Œ 1 ä¸ªèŠ‚ç‚¹
    æ‰§è¡ŒèŠ‚ç‚¹: search_q1 (search)
      âœ… æˆåŠŸ
  æ­¥éª¤ 2: æ‰§è¡Œ 2 ä¸ªèŠ‚ç‚¹
    æ‰§è¡ŒèŠ‚ç‚¹: search_q2 (search)
      âœ… æˆåŠŸ
    æ‰§è¡ŒèŠ‚ç‚¹: search_q3 (search)
      âœ… æˆåŠŸ
  æ­¥éª¤ 3: æ‰§è¡Œ 1 ä¸ªèŠ‚ç‚¹
    æ‰§è¡ŒèŠ‚ç‚¹: result (result)
      âœ… å®Œæˆ
  æ­¥éª¤ 4: æ‰§è¡Œ 1 ä¸ªèŠ‚ç‚¹
    æ‰§è¡ŒèŠ‚ç‚¹: end (end)
      âœ… å®Œæˆ
  æ­¥éª¤ 5: æ‰€æœ‰èŠ‚ç‚¹æ‰§è¡Œå®Œæˆ

ğŸ“ˆ æœ€ç»ˆçŠ¶æ€ç»Ÿè®¡:
  completed: 6 ä¸ªèŠ‚ç‚¹
  æˆåŠŸç‡: 100.00%
```

## é…ç½®é€‰é¡¹

### MindSearchAgent å‚æ•°

- `max_sub_queries`: æœ€å¤§å­æŸ¥è¯¢æ•°é‡ï¼ˆé»˜è®¤: 5ï¼‰
- `max_search_results`: æ¯ä¸ªå­æŸ¥è¯¢çš„æœ€å¤§æœç´¢ç»“æœæ•°ï¼ˆé»˜è®¤: 10ï¼‰
- `search_manager`: æœç´¢ç®¡ç†å™¨å®ä¾‹

### å›è°ƒå‡½æ•°

å›è°ƒå‡½æ•°ç”¨äºç›‘æ§æœç´¢è¿›åº¦ï¼Œæ¥æ”¶ä»¥ä¸‹å‚æ•°ï¼š

- `message`: è¿›åº¦æ¶ˆæ¯
- `**kwargs`: é¢å¤–ä¿¡æ¯ï¼ˆå¦‚å›¾å¯¹è±¡ã€èŠ‚ç‚¹ä¿¡æ¯ç­‰ï¼‰

```python
def callback(message: str, **kwargs):
    print(f"ğŸ“¢ {message}")
    
    # å¤„ç†å›¾ç›¸å…³ä¿¡æ¯
    if 'graph' in kwargs:
        graph = kwargs['graph']
        ready_nodes = graph.get_ready_nodes()
        print(f"å¯æ‰§è¡ŒèŠ‚ç‚¹: {len(ready_nodes)}")
    
    # å¤„ç†å…¶ä»–ä¿¡æ¯
    for key, value in kwargs.items():
        if key != 'graph':
            print(f"  {key}: {value}")
```

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **åˆç†è®¾ç½®å‚æ•°**: æ ¹æ®æŸ¥è¯¢å¤æ‚åº¦è°ƒæ•´ `max_sub_queries` å’Œ `max_search_results`
2. **ä½¿ç”¨å›è°ƒç›‘æ§**: é€šè¿‡å›è°ƒå‡½æ•°ç›‘æ§é•¿æ—¶é—´è¿è¡Œçš„æŸ¥è¯¢
3. **é”™è¯¯å¤„ç†**: å®ç°é€‚å½“çš„é”™è¯¯å¤„ç†é€»è¾‘
4. **ç»Ÿè®¡åˆ†æ**: å®šæœŸåˆ†æç»Ÿè®¡ä¿¡æ¯ä»¥ä¼˜åŒ–æŸ¥è¯¢ç­–ç•¥

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **å¯¼å…¥é”™è¯¯**: ç¡®ä¿åœ¨æ­£ç¡®çš„é¡¹ç›®ç›®å½•ä¸­è¿è¡Œè„šæœ¬
2. **æœç´¢å¼•æ“é…ç½®**: ç¡®ä¿æœç´¢ç®¡ç†å™¨æ­£ç¡®é…ç½®
3. **ä¾èµ–å¾ªç¯**: æ£€æŸ¥å­æŸ¥è¯¢ä¾èµ–å…³ç³»æ˜¯å¦å­˜åœ¨å¾ªç¯
4. **å†…å­˜ä½¿ç”¨**: å¯¹äºå¤§å‹æŸ¥è¯¢ï¼Œæ³¨æ„å†…å­˜ä½¿ç”¨æƒ…å†µ

### è°ƒè¯•æŠ€å·§

1. ä½¿ç”¨è¯¦ç»†çš„å›è°ƒå‡½æ•°ç›‘æ§æ‰§è¡Œè¿‡ç¨‹
2. æ£€æŸ¥å›¾ç»Ÿè®¡ä¿¡æ¯äº†è§£æ‰§è¡ŒçŠ¶æ€
3. æŸ¥çœ‹èŠ‚ç‚¹è¯¦æƒ…äº†è§£å¤±è´¥åŸå› 
4. ä½¿ç”¨æµ‹è¯•è„šæœ¬éªŒè¯å›¾åŠŸèƒ½

## æœªæ¥æ‰©å±•

å›¾çŠ¶æ€ç®¡ç†åŠŸèƒ½ä¸ºæœªæ¥æ‰©å±•æä¾›äº†è‰¯å¥½çš„åŸºç¡€ï¼š

1. **å¯è§†åŒ–ç•Œé¢**: å®æ—¶æ˜¾ç¤ºå›¾æ‰§è¡ŒçŠ¶æ€
2. **åŠ¨æ€è°ƒæ•´**: æ ¹æ®æ‰§è¡Œæƒ…å†µåŠ¨æ€è°ƒæ•´å›¾ç»“æ„
3. **ç¼“å­˜æœºåˆ¶**: ç¼“å­˜å­æŸ¥è¯¢ç»“æœä»¥æé«˜æ•ˆç‡
4. **åˆ†å¸ƒå¼æ‰§è¡Œ**: æ”¯æŒè·¨å¤šä¸ªèŠ‚ç‚¹çš„åˆ†å¸ƒå¼æŸ¥è¯¢æ‰§è¡Œ
5. **æ™ºèƒ½è°ƒåº¦**: åŸºäºèµ„æºä½¿ç”¨æƒ…å†µçš„æ™ºèƒ½èŠ‚ç‚¹è°ƒåº¦

## æ€»ç»“

å›¾çŠ¶æ€ç®¡ç†åŠŸèƒ½æ˜¾è‘—å¢å¼ºäº† MindSearchAgent çš„èƒ½åŠ›ï¼Œæä¾›äº†ï¼š

- âœ… æ›´é«˜çš„æŸ¥è¯¢æ‰§è¡Œæ•ˆç‡
- âœ… æ›´å¥½çš„é”™è¯¯å¤„ç†å’Œæ¢å¤
- âœ… è¯¦ç»†çš„æ‰§è¡Œç»Ÿè®¡å’Œç›‘æ§
- âœ… å¯æ‰©å±•çš„æ¶æ„è®¾è®¡
- âœ… æ˜“äºä½¿ç”¨çš„APIæ¥å£

é€šè¿‡è¿™äº›åŠŸèƒ½ï¼ŒMindSearchAgent ç°åœ¨èƒ½å¤Ÿæ›´æ™ºèƒ½ã€æ›´é«˜æ•ˆåœ°å¤„ç†å¤æ‚çš„æœç´¢æŸ¥è¯¢ä»»åŠ¡ã€‚